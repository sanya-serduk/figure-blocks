/*! For license information please see index.047738dd58da37684a4f.js.LICENSE.txt */
!function(){"use strict";var t={1:function(t,e,r){var n=r(933),i=r.n(n),o=r(476),s=r.n(o),a=r(678),u=r.n(a),c=new URL(r(239),r.b),l=s()(i()),h=u()(c);l.push([t.id,"* {\r\n    -webkit-touch-callout:none;\r\n    -webkit-user-select:none;\r\n    -khtml-user-select:none;\r\n    -moz-user-select:none;\r\n    -ms-user-select:none;\r\n    user-select:none;\r\n    -webkit-tap-highlight-color:rgba(0,0,0,0);\r\n}\r\n\r\nhtml, body {\r\n    width: 100%;\r\n    height: 100%;\r\n    margin: 0;\r\n    overflow: hidden;\r\n}\r\n\r\nbody {\r\n    position: relative;\r\n    background: #d5c6c2 url("+h+") no-repeat center/cover;\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n}\r\n\r\n#cnv {\r\n    display: block;\r\n}\r\n\r\n#load-layer {\r\n    position: absolute;\r\n    width: 100%;\r\n    height: 100%;\r\n    background-color: #d5c6c2;\r\n    pointer-events: none;\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n}\r\n\r\n#load-layer.hide {\r\n    transition: 1.5s;\r\n    opacity: 0;\r\n}\r\n\r\n#load-layer.none {\r\n    display: none;\r\n}\r\n\r\n.load-icon {\r\n    display: grid;\r\n    grid-template-columns: 1fr 1fr;\r\n    grid-template-rows: 1fr 1fr;\r\n    gap: 15px;\r\n    animation: load-icon ease-in-out 1s infinite alternate;\r\n}\r\n\r\n.figure {\r\n    display: grid;\r\n    grid-template-columns: 1fr 1fr 1fr;\r\n    grid-template-rows: 1fr 1fr 1fr;\r\n    gap: 2px;\r\n}\r\n\r\n.figure-tile {\r\n    width: 30px;\r\n    height: 30px;\r\n    background-color: #eee1dd;\r\n    border-radius: 5px;\r\n    box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.4);\r\n}\r\n\r\n@keyframes load-icon {\r\n    to {\r\n        transform: scale(1.1);\r\n    }\r\n}",""]),e.Z=l},476:function(t){t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var r="",n=void 0!==e[5];return e[4]&&(r+="@supports (".concat(e[4],") {")),e[2]&&(r+="@media ".concat(e[2]," {")),n&&(r+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),r+=t(e),n&&(r+="}"),e[2]&&(r+="}"),e[4]&&(r+="}"),r})).join("")},e.i=function(t,r,n,i,o){"string"==typeof t&&(t=[[null,t,void 0]]);var s={};if(n)for(var a=0;a<this.length;a++){var u=this[a][0];null!=u&&(s[u]=!0)}for(var c=0;c<t.length;c++){var l=[].concat(t[c]);n&&s[l[0]]||(void 0!==o&&(void 0===l[5]||(l[1]="@layer".concat(l[5].length>0?" ".concat(l[5]):""," {").concat(l[1],"}")),l[5]=o),r&&(l[2]?(l[1]="@media ".concat(l[2]," {").concat(l[1],"}"),l[2]=r):l[2]=r),i&&(l[4]?(l[1]="@supports (".concat(l[4],") {").concat(l[1],"}"),l[4]=i):l[4]="".concat(i)),e.push(l))}},e}},678:function(t){t.exports=function(t,e){return e||(e={}),t?(t=String(t.__esModule?t.default:t),/^['"].*['"]$/.test(t)&&(t=t.slice(1,-1)),e.hash&&(t+=e.hash),/["'() \t\n]|(%20)/.test(t)||e.needQuotes?'"'.concat(t.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):t):t}},933:function(t){t.exports=function(t){return t[1]}},892:function(t){var e=[];function r(t){for(var r=-1,n=0;n<e.length;n++)if(e[n].identifier===t){r=n;break}return r}function n(t,n){for(var o={},s=[],a=0;a<t.length;a++){var u=t[a],c=n.base?u[0]+n.base:u[0],l=o[c]||0,h="".concat(c," ").concat(l);o[c]=l+1;var f=r(h),y={css:u[1],media:u[2],sourceMap:u[3],supports:u[4],layer:u[5]};if(-1!==f)e[f].references++,e[f].updater(y);else{var p=i(y,n);n.byIndex=a,e.splice(a,0,{identifier:h,updater:p,references:1})}s.push(h)}return s}function i(t,e){var r=e.domAPI(e);return r.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;r.update(t=e)}else r.remove()}}t.exports=function(t,i){var o=n(t=t||[],i=i||{});return function(t){t=t||[];for(var s=0;s<o.length;s++){var a=r(o[s]);e[a].references--}for(var u=n(t,i),c=0;c<o.length;c++){var l=r(o[c]);0===e[l].references&&(e[l].updater(),e.splice(l,1))}o=u}}},311:function(t){var e={};t.exports=function(t,r){var n=function(t){if(void 0===e[t]){var r=document.querySelector(t);if(window.HTMLIFrameElement&&r instanceof window.HTMLIFrameElement)try{r=r.contentDocument.head}catch(t){r=null}e[t]=r}return e[t]}(t);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");n.appendChild(r)}},60:function(t){t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},192:function(t,e,r){t.exports=function(t){var e=r.nc;e&&t.setAttribute("nonce",e)}},760:function(t){t.exports=function(t){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var e=t.insertStyleElement(t);return{update:function(r){!function(t,e,r){var n="";r.supports&&(n+="@supports (".concat(r.supports,") {")),r.media&&(n+="@media ".concat(r.media," {"));var i=void 0!==r.layer;i&&(n+="@layer".concat(r.layer.length>0?" ".concat(r.layer):""," {")),n+=r.css,i&&(n+="}"),r.media&&(n+="}"),r.supports&&(n+="}");var o=r.sourceMap;o&&"undefined"!=typeof btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),e.styleTagTransform(n,t,e.options)}(e,t,r)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}},865:function(t){t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}},239:function(t,e,r){t.exports=r.p+"524f90c0129de997d75c.png"}},e={};function r(n){var i=e[n];if(void 0!==i)return i.exports;var o=e[n]={id:n,exports:{}};return t[n](o,o.exports,r),o.exports}r.m=t,r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,{a:e}),e},r.d=function(t,e){for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/figure-blocks/",r.b=document.baseURI||self.location.href,r.nc=void 0,function(){var t=r(892),e=r.n(t),n=r(760),i=r.n(n),o=r(311),s=r.n(o),a=r(192),u=r.n(a),c=r(60),l=r.n(c),h=r(865),f=r.n(h),y=r(1),p={};function v(t){return v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},v(t)}function d(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,i=function(t,e){if("object"!==v(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==v(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===v(i)?i:String(i)),n)}var i}p.styleTagTransform=f(),p.setAttributes=u(),p.insert=s().bind(null,"head"),p.domAPI=i(),p.insertStyleElement=l(),e()(y.Z,p),y.Z&&y.Z.locals&&y.Z.locals;var m=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.updates=[],this.fps=60,this.raf=null,this.prevTimestamp=null,this.listener=this.update.bind(this)}var e,r;return e=t,(r=[{key:"start",value:function(){this.prevTimestamp=null,this.raf=requestAnimationFrame(this.listener)}},{key:"stop",value:function(){cancelAnimationFrame(this.listener),this.raf=null}},{key:"add",value:function(t,e){this.checkName(t)||(this.updates.push({name:t,callback:e}),null===this.raf&&this.start())}},{key:"remove",value:function(t){var e=this.updates.findIndex((function(e){return e.name===t}));-1!==e&&this.updates.splice(e,1)}},{key:"checkName",value:function(t){return-1!==this.updates.findIndex((function(e){return e.name===t}))}},{key:"update",value:function(t){if(this.updates.length){var e=null===this.prevTimestamp?1:(t-this.prevTimestamp)*this.fps/1e3;this.prevTimestamp=t,this.updates.forEach((function(t){return t.callback(e)})),this.raf=requestAnimationFrame(this.listener)}else this.stop()}}])&&d(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function b(t){return b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},b(t)}function g(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,i=function(t,e){if("object"!==b(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==b(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===b(i)?i:String(i)),n)}var i}var w=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.keys={},this.codes={},this.events=[{name:"keyup",handler:this.keyUp.bind(this)},{name:"keydown",handler:this.keyDown.bind(this)},{name:"blur",handler:this.resetKeys.bind(this)},{name:"contextmenu",handler:this.resetKeys.bind(this)}],this.listeners=[],this.init()}var e,r;return e=t,(r=[{key:"init",value:function(){this.add("down",["KeyS","ArrowDown"]),this.add("left",["KeyA","ArrowLeft"]),this.add("right",["KeyD","ArrowRight"]),this.add("space",["Space"]),this.events.forEach((function(t){return window.addEventListener(t.name,t.handler)}))}},{key:"destroy",value:function(){this.keys={},this.codes={},this.events.forEach((function(t){return window.removeEventListener(t.name,t.handler)}))}},{key:"add",value:function(t,e){var r=this;e.forEach((function(e){r.codes.hasOwnProperty(e)||(r.keys[t]=0,r.codes[e]=t)}))}},{key:"remove",value:function(t){if(this.keys.hasOwnProperty(t)){for(var e in this.codes)this.codes[e]===t&&delete this.codes[e];delete this.keys[t]}}},{key:"getState",value:function(t){return this.keys[t]}},{key:"setState",value:function(t,e){if(this.codes.hasOwnProperty(t)){var r=this.codes[t];this.getState(r)!==e&&(this.keys[this.codes[t]]=e,this.listeners.forEach((function(t){var n=t.keyName===r,i="keyup"===t.eventName&&!e,o="keydown"===t.eventName&&e;n&&(i||o)&&t.handler()})))}}},{key:"keyUp",value:function(t){this.setState(t.code,0)}},{key:"keyDown",value:function(t){this.setState(t.code,1)}},{key:"resetKeys",value:function(){for(var t in this.codes)this.setState(t,0)}},{key:"addListener",value:function(t,e,r,n){this.listeners.push({name:t,eventName:e,keyName:r,handler:n})}},{key:"removeListener",value:function(t){this.listeners=this.listeners.filter((function(e){return e.name!==t}))}}])&&g(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function x(t){return x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},x(t)}function S(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,i=function(t,e){if("object"!==x(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==x(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===x(i)?i:String(i)),n)}var i}var k=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.ctx=e,this.current=null,this.scenes={},this.layers=[]}var e,r;return e=t,(r=[{key:"add",value:function(t,e){this.scenes.hasOwnProperty(t)?console.log('Сцена "'.concat(t,'" уже добавлена')):this.scenes[t]=e}},{key:"addLayer",value:function(t,e){this.layers.find((function(e){return e.name===t}))||this.layers.push({name:t,layer:new e(this.ctx)})}},{key:"removeLayer",value:function(t){this.layers=this.layers.filter((function(e){return e.name!==t||("destroy"in e.layer&&e.layer.destroy(),!1)}))}},{key:"getLayer",value:function(t){var e;return(null===(e=this.layers.find((function(e){return e.name===t})))||void 0===e?void 0:e.layer)||null}},{key:"start",value:function(t,e){this.scenes.hasOwnProperty(t)?(null!==this.current&&"destroy"in this.current&&this.current.destroy(),this.current=new this.scenes[t](this.ctx,e)):console.log('Сцена "'.concat(t,'" не найдена'))}},{key:"remove",value:function(){}},{key:"draw",value:function(){null!==this.current&&"draw"in this.current&&this.current.draw(),this.layers.forEach((function(t){"draw"in t.layer&&t.layer.draw()}))}},{key:"update",value:function(t){null!==this.current&&"update"in this.current&&this.current.update(t),this.layers.forEach((function(e){"update"in e.layer&&e.layer.update(t)}))}}])&&S(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function P(t){return P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},P(t)}function T(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,i=function(t,e){if("object"!==P(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==P(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===P(i)?i:String(i)),n)}var i}var O=function(){function t(e,r,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.cnv=e,this.originSize={w:r,h:n},this.currentSize={w:r,h:n},this.scale=1,this.init()}var e,r;return e=t,(r=[{key:"init",value:function(){window.addEventListener("resize",this.update.bind(this)),this.update()}},{key:"size",get:function(){return this.currentSize}},{key:"update",value:function(){this.scale=Math.min(document.documentElement.clientWidth/this.originSize.w,document.documentElement.clientHeight/this.originSize.h),this.cnv.width=this.originSize.w*this.scale,this.cnv.height=this.originSize.h*this.scale,this.currentSize.w=this.cnv.width/this.scale,this.currentSize.h=this.cnv.height/this.scale}}])&&T(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function E(t){return E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},E(t)}function j(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,i=function(t,e){if("object"!==E(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==E(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===E(i)?i:String(i)),n)}var i}var L=function(){function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._name=e,this._data=r}var e,r;return e=t,(r=[{key:"getData",value:function(){var t={},e=JSON.parse(localStorage.getItem(this._name))||{};for(var r in this._data)t[r]=E(e[r])===E(this._data[r])?e[r]:this._data[r];return t}},{key:"setData",value:function(t){var e={},r=this.getData();for(var n in this._data)e[n]=E(t[n])===E(this._data[n])?t[n]:r[n];localStorage.setItem(this._name,JSON.stringify(e))}}])&&j(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function C(t,e){return e.hasOwnProperty(t)?e[t]:e[e.default]}var A={get TITLE(){return C(app.user.lang,{ru:"Фигуры из блоков",en:"Block figures",tr:"Bloklardan şekiller",default:"ru"})},get SCORE(){return C(app.user.lang,{ru:"Счёт",en:"Score",tr:"Hesap",default:"ru"})},get RECORD(){return C(app.user.lang,{ru:"Рекорд",en:"Record",tr:"Rekor",default:"ru"})},get NEW_GAME(){return C(app.user.lang,{ru:"Новая игра",en:"New game",tr:"Yeni oyun",default:"ru"})},get START_OVER(){return C(app.user.lang,{ru:"Начать заново",en:"Start over",tr:"Baştan başlamak",default:"ru"})},get GAME_OVER(){return C(app.user.lang,{ru:"Конец игры",en:"Game over",tr:"Oyunun sonu",default:"ru"})},get CANCEL(){return C(app.user.lang,{ru:"Отмена",en:"Cancel",tr:"İptal",default:"ru"})},get CONTINUE(){return C(app.user.lang,{ru:"Продолжить",en:"Continue",tr:"Devam et",default:"ru"})},get BACK(){return C(app.user.lang,{ru:"Назад",en:"Back",tr:"Geri",default:"ru"})},get CONTROL(){return C(app.user.lang,{ru:"Управление",en:"Control",tr:"Yönetim",default:"ru"})},get HOW_TO_PLAY(){return C(app.user.lang,{ru:"Как играть ?",en:"How to play ?",tr:"Nasıl oynanır ?",default:"ru"})},get HOW_TO_PLAY_DESCRIPTION_FIGURES(){return C(app.user.lang,{ru:"Собирайте фигуры из блоков\nодного цвета\nи зарабатывайте очки",en:"Collect shapes from blocks\nof the same color and earn\npoints",tr:"Aynı renkteki bloklardan\nşekilleri toplayın ve puan\nkazanın",default:"ru"})},get HOW_TO_PLAY_DESCRIPTION_SUPER_TILES(){return C(app.user.lang,{ru:"Используйте супер блоки",en:"Use super blocks",tr:"Süper blokları kullanın",default:"ru"})},get EXIT(){return C(app.user.lang,{ru:"Выход",en:"Exit",tr:"Çıkış",default:"ru"})},get CONTROL_FROM_PC(){return{TITLE:C(app.user.lang,{ru:"Управление с ПК:",en:"Control from a PC:",tr:"PC'den kontrol:",default:"ru"}),ITEMS:[C(app.user.lang,{ru:"- Перемещение блока: WASD,\n  стрелки или экранные кнопки",en:"- Moving the block: WASD,\n  arrows or on-screen buttons",tr:"- Blok hareketi: WASD, oklar\n  veya ekran düğmeleri",default:"ru"}),C(app.user.lang,{ru:"- Пауза: пробел",en:"- Pause: Space",tr:"- Duraklat: Boşluk çubuğu",default:"ru"})]}},get CONTROL_FROM_MOBILE(){return{TITLE:C(app.user.lang,{ru:"Управление с мобильного:",en:"Mobile control:",tr:"Mobil cihazdan kontrol:",default:"ru"}),ITEMS:[C(app.user.lang,{ru:"- Перемещение блока: экранные\n  кнопки в виде стрелок",en:"- Moving the block: on-screen\n  buttons in the form of arrows",tr:"- Bloğu taşıma: Ok şeklinde\n  ekran düğmeleri",default:"ru"})]}},get CLOSE(){return C(app.user.lang,{ru:"Закрыть",en:"Close",tr:"Kapat",default:"ru"})},get POINTS(){return C(app.user.lang,{ru:"очков",en:"points",tr:"puan",default:"ru"})},get MIXED(){return C(app.user.lang,{ru:"Смешанный",en:"Mixed",tr:"Karışık",default:"ru"})},get TILE_MIXED_DESC(){return C(app.user.lang,{ru:"Заменяет блок любого цвета",en:"Replaces a block of any color",tr:"Herhangi bir üniteyi değiştirir",default:"ru"})},get DESTROYER(){return C(app.user.lang,{ru:"Разрушитель",en:"Destroyer",tr:"Yıkıcı",default:"ru"})},get TILE_DESTROYER_DESC(){return C(app.user.lang,{ru:"Удаляет блоки вокруг себя",en:"Removes blocks around itself",tr:"Etrafındaki blokları kaldırır",default:"ru"})}};function B(t){return B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},B(t)}function R(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,i=function(t,e){if("object"!==B(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==B(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===B(i)?i:String(i)),n)}var i}var _=function(){function t(){var e;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.score=0,this.record=0,this.game="",this.training=!1,this.lang=null!==(e=navigator.language||navigator.userLanguage)&&void 0!==e?e:"ru",this.supportedLanguages=["ru","en","tr"],this.db=new L("figure-blocks__user",{record:this.record,lang:this.lang,game:this.game,training:this.training}),this.init()}var e,r;return e=t,r=[{key:"init",value:function(){var t=this.db.getData();this.record=t.record,this.lang=t.lang,this.game=t.game,this.training=t.training}},{key:"setStorageData",value:function(){this.db.setData({record:this.record,lang:this.lang,game:this.game,training:!0})}},{key:"setGameSave",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.game!==t&&(this.game=t,this.setStorageData())}},{key:"setGameTraining",value:function(t){this.training!==t&&(this.training=t,this.setStorageData())}},{key:"upScore",value:function(t){this.setScore(this.score+Number(t))}},{key:"setScore",value:function(t){this.score=Number(t),this.score>this.record&&(this.record=this.score,this.setStorageData())}},{key:"resetScore",value:function(){this.score=0}},{key:"changeLanguage",value:function(t){this.supportedLanguages.includes(t)&&(this.lang=t,document.title=A.TITLE,this.setStorageData())}}],r&&R(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function M(t){return M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},M(t)}function D(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,i=function(t,e){if("object"!==M(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==M(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===M(i)?i:String(i)),n)}var i}var z=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.buttons={},this.listeners=[]}var e,r;return e=t,(r=[{key:"add",value:function(t,e){this.buttons.hasOwnProperty(t)||(this.buttons[t]={}),this.buttons[t][e]=0}},{key:"remove",value:function(t,e){this.buttons.hasOwnProperty(t)&&this.buttons[t].hasOwnProperty(e)&&(delete this.buttons[t][e],0===Object.keys(this.buttons[t]).length&&delete this.buttons[t])}},{key:"getState",value:function(t,e){if(this.buttons.hasOwnProperty(t)){if(this.buttons[t].hasOwnProperty(e))return this.buttons[t][e];console.log('Имя "'.concat(e,'" не найдено'))}else console.log('Тип "'.concat(t,'" не найден'))}},{key:"setState",value:function(t,e,r){this.buttons.hasOwnProperty(t)?this.buttons[t].hasOwnProperty(e)?(this.buttons[t][e]=r,this.event(t,e)):console.log('Имя "'.concat(e,'" не найдено')):console.log('Тип "'.concat(t,'" не найден'))}},{key:"event",value:function(t,e){var r=this;this.listeners.forEach((function(n){n.type===t&&n.name===e&&n.handler(r.buttons[t][e])}))}},{key:"on",value:function(t,e,r){this.listeners.push({type:t,name:e,handler:r})}},{key:"off",value:function(t,e){this.listeners=this.listeners.filter((function(r){return r.type!==t&&r.name!==e}))}}])&&D(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function I(t){return I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},I(t)}function Y(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,i=function(t,e){if("object"!==I(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==I(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===I(i)?i:String(i)),n)}var i}var N=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.cnv=e,this.ctx=e.getContext("2d"),this.scaleManager=new O(e,720,1280),this.ticker=new m,this.keyboard=new w,this.scene=new k(this.ctx),this.user=new _,this.stateButtons=new z,this.resources={tiles:{}},this.init()}var e,r;return e=t,(r=[{key:"init",value:function(){this.ticker.add("app-update",this.update.bind(this))}},{key:"scale",get:function(){return this.scaleManager.scale}},{key:"size",get:function(){return this.scaleManager.size}},{key:"update",value:function(t){this.scene.update(t),this.ctx.setTransform(this.scale,0,0,this.scale,0,0),this.ctx.clearRect(0,0,this.size.w,this.size.h),this.ctx.translate(this.size.w/2,this.size.h/2),this.scene.draw()}}])&&Y(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function F(t){return F="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},F(t)}function H(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,i=function(t,e){if("object"!==F(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==F(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===F(i)?i:String(i)),n)}var i}var G=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,r;return e=t,r=[{key:"getRandomInteger",value:function(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t}},{key:"isTouchDevice",get:function(){return"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0}},{key:"getPath2DRoundRect",value:function(t,e,r,n,i){i=Math.min(r/2,n/2,i);var o=new Path2D;return o.moveTo(t+i,e),o.arcTo(t+r,e,t+r,e+n,i),o.arcTo(t+r,e+n,t,e+n,i),o.arcTo(t,e+n,t,e,i),o.arcTo(t,e,t+r,e,i),o.closePath(),o}},{key:"getPath2DRoundedPolygon",value:function(t,e){var r,n,i,o,s,a,u,c,l,h,f,y,p,v,d,m,b,g,w=new Path2D,x=function(t,e,r){r.x=e.x-t.x,r.y=e.y-t.y,r.len=Math.sqrt(r.x*r.x+r.y*r.y),r.nx=r.x/r.len,r.ny=r.y/r.len,r.ang=Math.atan2(r.ny,r.nx)};for(g=e,c={},l={},s=t[(o=t.length)-1],r=0;r<o;r++){a=t[r%o],u=t[(r+1)%o],x(a,s,c),x(a,u,l),h=c.nx*l.ny-c.ny*l.nx,f=c.nx*l.nx-c.ny*-l.ny,v=Math.asin(h<-1?-1:h>1?1:h),y=1,p=!1,f<0?v<0?v=Math.PI+v:(v=Math.PI-v,y=-1,p=!0):v>0&&(y=-1,p=!0),g=void 0!==a.radius?a.radius:e,d=v/2,(b=Math.abs(Math.cos(d)*g/Math.sin(d)))>Math.min(c.len/2,l.len/2)?(b=Math.min(c.len/2,l.len/2),m=Math.abs(b*Math.sin(d)/Math.cos(d))):m=g,n=a.x+l.nx*b,i=a.y+l.ny*b,n+=-l.ny*m*y,i+=l.nx*m*y;var S=c.ang+Math.PI/2*y,k=l.ang-Math.PI/2*y;w.arc(n,i,m,S,k,p),s=a,a=u}return w.closePath(),w}},{key:"gridArrayToString",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:",",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return t.map((function(t){return t.join(r)})).join(e)}},{key:"stringToGridArray",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:",",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return t.split(e).map((function(t){return t.split(r)}))}},{key:"getGridArray",value:function(t,e,r){for(var n=[],i=0;i<t;i++){n[i]=[];for(var o=0;o<e;o++)n[i][o]=r}return n}}],null&&H(e.prototype,null),r&&H(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}(),X="rgb(115,97,97)",W="#eee1dd",U="Balsamiq Sans",K=85,q=45;function V(t){return V="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},V(t)}function J(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,i=function(t,e){if("object"!==V(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==V(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===V(i)?i:String(i)),n)}var i}var Z=function(){function t(e,r){var n,i;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.ctx=e,this.x=r.x||0,this.y=r.y||0,this.offsetX=r.offsetX||0,this.offsetY=r.offsetY||0,this.isActive=null===(n=r.isActive)||void 0===n||n,this.fz=52,this.w=0,this.h=2*this.fz+20,this.dark=r.dark||!1,this.color=this.dark?"rgb(115,97,97)":"#eee1dd",this.colorHover=this.dark?"rgb(108,90,90)":"#f3e9e7",this.textColor=this.dark?"#eee1dd":"rgb(115,97,97)",this.text="".concat(r.text||"button"),this.font="".concat(this.fz,"px ").concat(U),this.hover=0,this.handler=r.handler||function(){},this.clickHandler=this.click.bind(this),this.mousemoveHandler=this.mousemove.bind(this),this.isActive=null===(i=r.isActive)||void 0===i||i,this.path2D=new Path2D,this.init(),this.isActive&&this.addListeners()}var e,r;return e=t,(r=[{key:"init",value:function(){this.ctx.save(),this.ctx.font=this.font;var t=this.ctx.measureText(this.text);this.w=t.width+this.h,this.ctx.restore(),this.path2D=G.getPath2DRoundRect(0,0,this.w,this.h,30)}},{key:"destroy",value:function(){this.removeListeners()}},{key:"setActive",value:function(t){this.isActive=t,this.isActive?this.addListeners():this.removeListeners()}},{key:"addListeners",value:function(){app.cnv.addEventListener("click",this.clickHandler),window.addEventListener("mousemove",this.mousemoveHandler)}},{key:"removeListeners",value:function(){app.cnv.removeEventListener("click",this.clickHandler),window.removeEventListener("mousemove",this.mousemoveHandler),this.hover=0}},{key:"click",value:function(t){var e=app.cnv.getBoundingClientRect(),r=(t.clientX-e.left)/app.scale-app.size.w/2,n=(t.clientY-e.top)/app.scale-app.size.h/2;r>this.x-this.w/2&&r<this.x+this.w/2&&n>this.y-this.h/2&&n<this.y+this.h/2&&this.handler()}},{key:"mousemove",value:function(t){var e=app.cnv.getBoundingClientRect(),r=(t.clientX-e.x)/app.scale-app.size.w/2,n=(t.clientY+this.offsetY-e.y)/app.scale-app.size.h/2;this.hover=r>this.x-this.w/2&&r<this.x+this.w/2&&n>this.y-this.h/2&&n<this.y+this.h/2}},{key:"updatePosition",value:function(t,e){this.x=t,this.y=e}},{key:"setOffset",value:function(t,e){this.offsetX=t,this.offsetY=e}},{key:"draw",value:function(){this.ctx.save(),this.ctx.translate(this.x-this.w/2,this.y-this.h/2),this.ctx.shadowBlur=4,this.ctx.shadowColor="rgba(0,0,0,0.2)",this.ctx.shadowOffsetX=2,this.ctx.shadowOffsetY=2,this.ctx.fillStyle=this.hover?this.colorHover:this.color,this.ctx.fill(this.path2D),this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillStyle=this.textColor,this.ctx.font=this.font,this.ctx.fillText(this.text,this.w/2,this.h/2+5),this.ctx.restore()}}])&&J(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function $(t){return $="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},$(t)}function Q(t){return function(t){if(Array.isArray(t))return tt(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return tt(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?tt(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function tt(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function et(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,i=function(t,e){if("object"!==$(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==$(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===$(i)?i:String(i)),n)}var i}var rt=function(){function t(e){var r=this,n=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).isActive,i=void 0===n||n;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.ctx=e,this.isActive=i,this.x=0,this.y=0,this.titleSize=K,this.titleFont="".concat(this.titleSize,"px ").concat(U),this.titleY=0,this.sectionButtons=[new Z(e,{text:A.NEW_GAME,isActive:this.isActive,handler:function(){return app.scene.start("Game")}}),new Z(e,{text:A.CONTROL,isActive:this.isActive,handler:function(){return app.scene.start("Control")}}),new Z(e,{text:A.HOW_TO_PLAY,isActive:this.isActive,handler:function(){return app.scene.start("About")}})],this.languageButtons=[new Z(e,{text:"РУ",handler:function(){return r.changeLanguage("ru")},isActive:this.isActive}),new Z(e,{text:"EN",handler:function(){return r.changeLanguage("en")},isActive:this.isActive}),new Z(e,{text:"TR",handler:function(){return r.changeLanguage("tr")},isActive:this.isActive})],this.buttons=[].concat(Q(this.sectionButtons),Q(this.languageButtons)),this.init()}var e,r;return e=t,(r=[{key:"init",value:function(){var t=this;if(app.user.game){var e=new Z(this.ctx,{text:A.CONTINUE,isActive:this.isActive,handler:function(){return app.scene.start("Game",{isContinue:!0})}});this.sectionButtons.unshift(e),this.buttons.unshift(e)}var r=-(this.titleSize+80+(this.buttons[0].h+20)*(this.sectionButtons.length+1))/2,n=r+this.titleSize+80+this.buttons[0].h/2;this.titleY=r+this.titleSize,this.sectionButtons.forEach((function(e,r){return e.updatePosition(0,n+(t.buttons[0].h+20)*r)})),this.languageButtons.forEach((function(e,r){return e.updatePosition((t.languageButtons[0].w+20)*r-(t.languageButtons[0].w+20)*(t.languageButtons.length-1)/2,n+(t.buttons[0].h+20)*t.sectionButtons.length)}))}},{key:"destroy",value:function(){this.buttons.forEach((function(t){return t.destroy()})),app.cnv.style.cursor=""}},{key:"changeLanguage",value:function(t){app.user.changeLanguage(t),app.scene.start("Main")}},{key:"setActive",value:function(t){var e=this;this.isActive=t,this.buttons.forEach((function(t){return t.setActive(e.isActive)}))}},{key:"draw",value:function(){this.ctx.save(),this.ctx.translate(this.x,this.y),this.ctx.shadowBlur=4,this.ctx.shadowColor="rgba(0,0,0,0.1)",this.ctx.shadowOffsetX=2,this.ctx.shadowOffsetY=2,this.ctx.font=this.titleFont,this.ctx.fillStyle=X,this.ctx.textAlign="center",this.ctx.fillText("".concat(A.RECORD,": ").concat(app.user.record),0,this.titleY),this.buttons.forEach((function(t){return t.draw()})),this.ctx.restore()}},{key:"update",value:function(){app.cnv.style.cursor=this.buttons.some((function(t){return t.hover}))?"pointer":"initial"}}])&&et(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function nt(t){return nt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},nt(t)}function it(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,i=function(t,e){if("object"!==nt(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==nt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===nt(i)?i:String(i)),n)}var i}var ot=function(){function t(e){var r=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).isActive,n=void 0===r||r;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.ctx=e,this.isActive=n,this.menuLayer=new rt(e,{isActive:n})}var e,r;return e=t,(r=[{key:"destroy",value:function(){this.menuLayer.destroy()}},{key:"setActive",value:function(t){this.isActive=t,this.menuLayer.setActive(t)}},{key:"draw",value:function(){this.menuLayer.draw()}},{key:"update",value:function(t){this.menuLayer.update(t)}}])&&it(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function st(t){return st="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},st(t)}function at(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,i=function(t,e){if("object"!==st(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==st(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===st(i)?i:String(i)),n)}var i}var ut=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.isLoaded=!1,this.timeout=100,this.loadedCallback=null,this.loadLayer=document.getElementById("load-layer"),this.loadLayer.classList.remove("hide","none"),this.handlerTransitionend=this.transitionend.bind(this),this.loadLayer.addEventListener("transitionend",this.handlerTransitionend)}var e,r;return e=t,r=[{key:"destroy",value:function(){this.loadLayer.removeEventListener("transitionend",this.handlerTransitionend),this.loadLayer=null,this.loadedCallback=null}},{key:"transitionend",value:function(){this.loadLayer.classList.add("none"),app.scene.removeLayer("Load")}},{key:"loaded",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.loadedCallback=t,this.isLoaded=!0}},{key:"update",value:function(t){if(this.isLoaded&&!this.timeout)return null!==this.loadedCallback&&(this.loadedCallback(),this.loadedCallback=null),void this.loadLayer.classList.add("hide");this.timeout=Math.max(this.timeout-1*t,0)}}],r&&at(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function ct(t){return ct="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ct(t)}function lt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,i=function(t,e){if("object"!==ct(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==ct(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===ct(i)?i:String(i)),n)}var i}var ht=function(){function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.ctx=e,this.x=r.x||0,this.y=r.y||0,this.size=r.size||70,this.id=r.id||"0",this.color=r.color||"#fff",this.row=r.row||null,this.col=r.col||null,this.skin=app.resources.tiles[r.name],this.speedX=8,this.speedY=1,this.destroyed=!1,this.removed=!1,this.scale=1,this.moved=!1,this.boostY=0,this.endX=this.x,this.endY=this.y,this.timeuotY=0}var e,r;return e=t,r=[{key:"setCell",value:function(t,e){this.row=t,this.col=e}},{key:"unsetCell",value:function(){this.row=null,this.col=null}},{key:"destroy",value:function(){this.removed=!0,this.row=null,this.col=null}},{key:"setPositionY",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.endY=t,this.moved=!0,this.timeuotY=e}},{key:"setMoveX",value:function(t){0!==t&&this.x===this.endX&&(this.endX=this.x+t,this.moved=!0)}},{key:"setBoostY",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;this.boostY=t}},{key:"draw",value:function(){this.ctx.save();var t=(this.size-this.size*this.scale)/2;this.ctx.translate(this.x+t,this.y+t),this.ctx.scale(this.scale,this.scale),this.ctx.globalAlpha=this.scale,this.ctx.drawImage(this.skin,-2,-2),this.ctx.restore()}},{key:"update",value:function(t){if(!this.destroyed){if(this.removed&&(this.scale<=0&&(this.destroyed=!0),this.scale=Math.max(this.scale-.05*t,0)),this.y!==this.endY)if(this.timeuotY>0)this.timeuotY=Math.max(this.timeuotY-1*t,0);else{var e=(this.speedY+this.boostY)*t;this.y=this.y+e<this.endY?this.y+e:this.endY}if(this.x!==this.endX){var r=this.speedX*t,n=this.endX-this.x;if(Math.abs(n)>r){var i=r*Math.sign(n);this.x+=i}else this.x=this.endX}this.x===this.endX&&this.y===this.endY&&(this.moved=!1),this.boostY=0}}}],r&&lt(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function ft(t){return ft="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ft(t)}function yt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,i=function(t,e){if("object"!==ft(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==ft(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===ft(i)?i:String(i)),n)}var i}var pt=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._figures=[]}var e,r;return e=t,r=[{key:"add",value:function(t,e){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=e.length,i=e[0].length,o=0;o<r;o++){for(var s=[],a=0;a<n;a++){s.push([]);for(var u=0;u<i;u++)0===o?s[a][u]=e[a][u]:1===o?s[a][u]=e[i-1-u][a]:2===o?s[a][u]=e[n-1-a][i-1-u]:3===o&&(s[a][u]=e[u][n-1-a])}this._figures.push({price:t,pattern:s})}this._figures.sort((function(t,e){return e.price-t.price}))}},{key:"figures",get:function(){return JSON.parse(JSON.stringify(this._figures))}}],r&&yt(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}(),vt=new pt;vt.add(10,[["0","1","0"],["1","1","1"],["0","1","0"]]),vt.add(20,[["0","1","0"],["1","1","1"],["1","0","1"]],4),vt.add(40,[["1","0","1"],["1","1","1"],["1","0","1"]],2),vt.add(80,[["1","1","1"],["1","0","1"],["1","1","1"]]);var dt=vt.figures;function mt(t){return mt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},mt(t)}function bt(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function gt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,wt(n.key),n)}}function wt(t){var e=function(t,e){if("object"!==mt(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==mt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===mt(e)?e:String(e)}var xt=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.allTiles=[],this.simpleTiles=[],this.superTiles=[],this.mapTilesID={},this.mapTilesName={}}var e,r;return e=t,r=[{key:"add",value:function(t){var e=function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?bt(Object(r),!0).forEach((function(e){var n,i,o;n=t,i=e,o=r[e],(i=wt(i))in n?Object.defineProperty(n,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[i]=o})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):bt(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({ID:(this.allTiles.length+1).toString()},t);this.allTiles.push(e),this.mapTilesID[e.ID]=e,this.mapTilesName[e.NAME]=e,"simple"===e.TYPE&&this.simpleTiles.push(e),"super"===e.TYPE&&this.superTiles.push(e)}},{key:"ALL",get:function(){return this.allTiles}},{key:"SIMPLE",get:function(){return this.simpleTiles}},{key:"SUPER",get:function(){return this.superTiles}},{key:"GET_BY_ID",value:function(t){return this.mapTilesID[t]}},{key:"GET_BY_NAME",value:function(t){return this.mapTilesName[t]}}],r&&gt(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}(),St=new xt;St.add({TYPE:"simple",NAME:"red",COLOR:"#cb4a50"}),St.add({TYPE:"simple",NAME:"green",COLOR:"#65a43b"}),St.add({TYPE:"simple",NAME:"blue",COLOR:"#4f67c2"}),St.add({TYPE:"simple",NAME:"yellow",COLOR:"#e0ab25"}),St.add({TYPE:"simple",NAME:"purple",COLOR:"#a055c9"}),St.add({TYPE:"super",NAME:"mixed",COLOR:"#d9cfcf"}),St.add({TYPE:"super",NAME:"bomb",COLOR:"#505050"});var kt=St;function Pt(t){return Pt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Pt(t)}function Tt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,i=function(t,e){if("object"!==Pt(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Pt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===Pt(i)?i:String(i)),n)}var i}var Ot=function(){function t(e,r,n,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.ctx=e,this.x=r,this.y=n,this.num=i,this.alpha=1,this.destroyed=!1,this.timeout=30,this.speed=2}var e,r;return e=t,(r=[{key:"draw",value:function(){this.ctx.save(),this.ctx.translate(this.x,this.y),this.ctx.globalAlpha=this.alpha,this.ctx.shadowBlur=4,this.ctx.shadowColor="rgba(0,0,0,".concat(this.alpha,")"),this.ctx.shadowOffsetX=2,this.ctx.shadowOffsetY=2,this.ctx.fillStyle="#fff",this.ctx.font="bold 36px Balsamiq Sans",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText(this.num,0,0),this.ctx.restore()}},{key:"update",value:function(t){this.destroyed||(this.alpha<=0?this.destroyed=!0:(this.timeout>0?this.timeout-=1*t:this.alpha=Math.max(this.alpha-.02*t,0),this.y-=this.speed*t))}}])&&Tt(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Et(t){return Et="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Et(t)}function jt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,i=function(t,e){if("object"!==Et(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Et(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===Et(i)?i:String(i)),n)}var i}var Lt=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,r;return e=t,r=[{key:"createCanvas",value:function(t,e){var r=document.createElement("canvas"),n=r.getContext("2d");return r.width=t,r.height=e,{cnv:r,ctx:n}}},{key:"getTile",value:function(t){var e=t.id,r=t.color,n=t.size,i=t.rounded,o=void 0===i?10:i,s=t.fontSize,a=void 0===s?32:s,u=t.fontFamily,c=void 0===u?U:u,l=this.createCanvas(n,n),h=l.cnv,f=l.ctx,y=G.getPath2DRoundRect(1,1,n-2,n-2,o),p=G.getPath2DRoundRect(2,2,n-4,n-4,o),v=f.createRadialGradient(n/2,n/2,0,n/2,n/2,n/1.5);return v.addColorStop(.6,"rgba(0,0,0,0)"),v.addColorStop(1,"rgba(0,0,0,0.15)"),f.fillStyle=r,f.fill(y),f.fillStyle=v,f.fill(y),f.strokeStyle="rgba(0,0,0,0.4)",f.lineWidth=2,f.stroke(p),f.font="".concat(a,"px ").concat(c),f.textAlign="center",f.textBaseline="middle",f.shadowBlur=15,f.shadowColor="#fff",f.fillStyle="rgba(0, 0, 0, 0.9)",f.fillText(e,n/2,n/2+3),h}},{key:"getTileSuper",value:function(t,e){return"mixed"===t?this.getTileSuperMixed(e):"bomb"===t?this.getTileSuperBomb(e):void 0}},{key:"getTileSuperMixed",value:function(t){var e=t.size,r=t.rounded,n=void 0===r?10:r,i=t.fontSize,o=void 0===i?42:i,s=t.fontFamily,a=void 0===s?U:s,u=this.createCanvas(e,e),c=u.cnv,l=u.ctx,h=G.getPath2DRoundRect(1,1,e-2,e-2,n),f=G.getPath2DRoundRect(2,2,e-4,e-4,n),y=l.createRadialGradient(e/2,e/2,0,e/2,e/2,e/1.5);return y.addColorStop(.6,"rgba(0,0,0,0)"),y.addColorStop(1,"rgba(0,0,0,0.15)"),l.fillStyle=kt.GET_BY_NAME("mixed").COLOR,l.fill(h),l.fillStyle=y,l.fill(h),l.strokeStyle="rgba(0,0,0,0.4)",l.lineWidth=2,l.stroke(f),l.font="".concat(o,"px ").concat(a),l.textAlign="center",l.textBaseline="middle",l.shadowBlur=15,l.shadowColor="#fff",l.fillStyle="rgba(0, 0, 0, 0.8)",l.fillText("+",e/2,e/2+1),c}},{key:"getTileSuperBomb",value:function(t){var e=t.size,r=t.rounded,n=void 0===r?10:r,i=t.fontSize,o=void 0===i?38:i,s=t.fontFamily,a=void 0===s?U:s,u=this.createCanvas(e,e),c=u.cnv,l=u.ctx,h=G.getPath2DRoundRect(1,1,e-2,e-2,n),f=G.getPath2DRoundRect(2,2,e-4,e-4,n),y=l.createRadialGradient(e/2,e/2,0,e/2,e/2,e/1.5);return y.addColorStop(.6,"rgba(0,0,0,0)"),y.addColorStop(1,"rgba(0,0,0,0.15)"),l.fillStyle=kt.GET_BY_NAME("bomb").COLOR,l.fill(h),l.fillStyle=y,l.fill(h),l.strokeStyle="rgba(0,0,0,0.4)",l.lineWidth=2,l.stroke(f),l.font="".concat(o,"px ").concat(a),l.textAlign="center",l.textBaseline="middle",l.shadowBlur=25,l.shadowColor="#000",l.fillStyle="rgba(255, 255, 255, 0.9)",l.fillText("×",e/2,e/2+1),c}},{key:"getField",value:function(t){var e=t.rows,r=t.cols,n=t.cellSize,i=t.cellColor,o=t.cellRound,s=void 0===o?6:o,a=this.createCanvas(n*r+4,n*e+4),u=a.cnv,c=a.ctx;c.fillStyle=i,c.shadowBlur=4,c.shadowColor="rgba(0,0,0,0.2)",c.shadowOffsetX=2,c.shadowOffsetY=2;for(var l=0;l<e;l++)for(var h=0;h<r;h++){var f=G.getPath2DRoundRect(n*h+1,n*l+1,n-2,n-2,s);c.fill(f)}return u}},{key:"getFigure",value:function(t){var e=t.pattern,r=t.tileName,n=t.tileSize,i=this.createCanvas(n*e.length+4,n*e.length+4),o=i.cnv,s=i.ctx;s.translate(2,2);for(var a=0;a<e.length;a++)for(var u=0;u<e[0].length;u++)"0"!==e[a][u]&&s.drawImage(app.resources.tiles[r],n*u-2,n*a-2);return o}}],null&&jt(e.prototype,null),r&&jt(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Ct(t){return Ct="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ct(t)}function At(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,i=function(t,e){if("object"!==Ct(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Ct(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===Ct(i)?i:String(i)),n)}var i}var Bt=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.ctx=e,this.y=0,this.amplitude=25,this.frequency=.1,this.time=0,this.arrowPath2D=G.getPath2DRoundedPolygon([{x:-50,y:60},{x:-25,y:60},{x:-25,y:0},{x:25,y:0},{x:25,y:60},{x:50,y:60},{x:0,y:120}],4)}var e,r;return e=t,(r=[{key:"draw",value:function(){this.ctx.save(),this.ctx.translate(0,this.y-200),this.ctx.shadowBlur=4,this.ctx.shadowOffsetX=2,this.ctx.shadowOffsetY=2,this.ctx.shadowColor="rgba(0,0,0,0.4)",this.ctx.lineWidth=1,this.ctx.fillStyle="#fff",this.ctx.strokeStyle="rgba(0,0,0,0.4)",this.ctx.fill(this.arrowPath2D),this.ctx.stroke(this.arrowPath2D),this.ctx.restore()}},{key:"update",value:function(t){this.time+=1*t,this.time%=2*Math.PI/this.frequency,this.y=this.amplitude*Math.sin(this.frequency*this.time)}}])&&At(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Rt(t){return Rt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Rt(t)}function _t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,i=function(t,e){if("object"!==Rt(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Rt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===Rt(i)?i:String(i)),n)}var i}var Mt=function(){function t(e,r,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.ctx=e,this.scene=r,this.game=n,this.arrow=new Bt(e),this.step=0,this.stepTiles=[{name:"green",type:"simple"},{name:"mixed",type:"super"},{name:"bomb",type:"super"}],this.init()}var e,r;return e=t,(r=[{key:"init",value:function(){var t=this,e=function(e,r,n){return{name:n,row:t.game.numRows-r,col:e-1}};[e(4,1,"red"),e(4,3,"red"),e(5,3,"red"),e(6,4,"red"),e(5,7,"red"),e(5,8,"red"),e(5,1,"yellow"),e(4,2,"yellow"),e(5,2,"yellow"),e(4,4,"yellow"),e(3,1,"yellow"),e(3,2,"yellow"),e(6,1,"green"),e(5,4,"green"),e(4,5,"green"),e(6,3,"green"),e(5,6,"green"),e(5,5,"green"),e(6,2,"purple"),e(5,9,"purple")].forEach((function(e){var r=kt.GET_BY_NAME(e.name),n=new ht(t.ctx,{x:e.col*t.game.tileSize,y:e.row*t.game.tileSize,size:t.game.tileSize,id:r.ID,name:r.NAME});n.setCell(e.row,e.col),t.game.field[e.row][e.col]=n.id,t.game.tiles.push(n)})),this.scene.headerLayer.setActive(!1),this.scene.headerLayer.buttons[3].setActive(!0),this.scene.footerLayer.setActive(!1),app.keyboard.remove("left"),app.keyboard.remove("down"),app.keyboard.remove("right"),app.keyboard.remove("space")}},{key:"destroy",value:function(){this.scene.headerLayer.setActive(!0),this.scene.footerLayer.setActive(!0),app.keyboard.add("down",["KeyS","ArrowDown"]),app.keyboard.add("left",["KeyA","ArrowLeft"]),app.keyboard.add("right",["KeyD","ArrowRight"]),app.keyboard.add("space",["Space"])}},{key:"tileGenerate",value:function(){if(this.stepTiles.length){var t=this.stepTiles.shift(),e=kt.GET_BY_NAME(t.name),r=new ht(this.ctx,{x:Math.floor(this.game.field[0].length/2)*this.game.tileSize,y:-(90+this.game.tileSize),size:this.game.tileSize,id:e.ID,name:e.NAME});r.speedY=5,this.game.tiles.push(r),this.game.tileCurrent=r,this.setStep()}else this.game.destroyGameTraining()}},{key:"setActiveButton",value:function(t,e){this.scene.footerLayer.buttons[t].setActive(e)}},{key:"getPositionFooterButton",value:function(t){return{x:this.scene.footerLayer.x+this.scene.footerLayer.buttons[t].x+app.size.w/6,y:this.scene.footerLayer.y+this.scene.footerLayer.buttons[t].y+app.size.w/6}}},{key:"setStep",value:function(){this.step+=1,this.scene.footerLayer.setActive(!1),app.keyboard.remove("left"),app.keyboard.remove("down"),app.keyboard.remove("right"),2!==this.step&&4!==this.step&&5!==this.step||(this.setActiveButton("down",!0),app.keyboard.add("down",["KeyS","ArrowDown"])),3===this.step&&(this.setActiveButton("left",!0),app.keyboard.add("left",["KeyA","ArrowLeft"])),1===this.step&&(this.setActiveButton("right",!0),app.keyboard.add("right",["KeyD","ArrowRight"]))}},{key:"draw",value:function(){if(null!==this.game.tileCurrent&&0!==this.step){if(this.ctx.save(),2===this.step||4===this.step||5===this.step){var t=this.getPositionFooterButton("down"),e=t.x,r=t.y;this.ctx.translate(e,r)}if(3===this.step){var n=this.getPositionFooterButton("left"),i=n.x,o=n.y;this.ctx.translate(i,o)}if(1===this.step){var s=this.getPositionFooterButton("right"),a=s.x,u=s.y;this.ctx.translate(a,u)}this.arrow.draw(),this.ctx.restore()}}},{key:"update",value:function(t){var e=this;if(this.arrow.update(t),null!==this.game.tileCurrent&&this.game.tileCurrent.y>-this.game.tileSize&&(this.game.tileCurrent.speedY=this.game.tileCurrent.speedY>.1?.96*this.game.tileCurrent.speedY:0),this.game.tiles=this.game.tiles.filter((function(t){if(t.destroyed)return!1;if(!t.moved&&!t.removed){var r=e.game.getPositionTile(t),n=r.row,i=r.col;t.setCell(n,i),e.game.field[n][i]=t.id,t===e.game.tileCurrent&&(e.game.tileCurrent=null)}return!0})),this.game.tiles.find((function(t){return t.moved}))||(this.game.clearBombOnField(),this.game.clearFiguresOnField()),this.game.tiles.find((function(t){return t.moved||t.removed}))||this.game.moveTilesDown(),this.game.tiles.find((function(t){return t.moved||t.destroyed||t.removed}))||this.tileGenerate(),null!==this.game.tileCurrent){var r=this.game.getPositionTile(this.game.tileCurrent),n=r.row,i=r.col,o=-1===n||"0"===this.game.field[n][i-1],s=-1===n||"0"===this.game.field[n][i+1],a=this.game.getStateControlButton("left")&&0!==i&&o,u=this.game.getStateControlButton("right")&&i<this.game.field[0].length-1&&s;this.game.tileCurrent.setMoveX((u-a)*this.game.tileSize),this.game.tileCurrent.setPositionY(this.game.getTileBorderY(n,i)),this.game.getStateControlButton("down")&&this.game.tileCurrent.setBoostY(),(1===this.step&&u||3===this.step&&a)&&this.setStep()}this.game.tiles.forEach((function(e){return e.update(t)})),this.game.scoreParticles=this.game.scoreParticles.filter((function(e){return!e.destroyed&&(e.update(t),!0)}))}}])&&_t(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Dt(t){return Dt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Dt(t)}function zt(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function It(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,i=function(t,e){if("object"!==Dt(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Dt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===Dt(i)?i:String(i)),n)}var i}var Yt=function(){function t(e,r){var n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).isContinue,i=void 0!==n&&n;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.ctx=e,this.scene=r,this.tiles=[],this.scoreParticles=[],this.numRows=13,this.numCols=9,this.field=G.getGridArray(this.numRows,this.numCols,"0"),this.tileSize=78,this.w=this.tileSize*this.field[0].length,this.h=this.tileSize*this.field.length,this.x=-this.w/2,this.y=-app.size.h/2+90,this.tileCurrent=null,this.nextTile=null,this.prevBoost={state:0,tile:this.tileCurrent},this.timeoutSuperTile=0,this.skinField=Lt.getField({rows:this.numRows,cols:this.numCols,cellSize:this.tileSize,cellColor:W}),this.gameTraining=null,this.initBase(),i?this.initSavedGame():this.initNewGame()}var e,r;return e=t,r=[{key:"initBase",value:function(){this.setTimeoutSuperTile()}},{key:"initNewGame",value:function(){app.user.setGameSave(),app.user.resetScore(),app.user.training||(this.gameTraining=new Mt(this.ctx,this.scene,this))}},{key:"initSavedGame",value:function(){if(app.user.game){var t=app.user.game.split("|");this.field=G.stringToGridArray(t[0]),this.nextTile=t[1],app.user.setScore(t[2]);for(var e=0;e<this.field.length;e++)for(var r=0;r<this.field[0].length;r++)if("0"!==this.field[e][r]){var n=kt.GET_BY_ID(this.field[e][r]);this.tiles.push(new ht(this.ctx,{x:r*this.tileSize,y:e*this.tileSize,size:this.tileSize,id:n.ID,name:n.NAME,row:e,col:r}))}}else this.initNewGame()}},{key:"gameSave",value:function(){var t=G.gridArrayToString(this.field),e="".concat(t,"|").concat(this.tileCurrent.id,"|").concat(app.user.score);app.user.setGameSave(e)}},{key:"gameOver",value:function(){this.scene.openModal("GameOver"),app.user.setGameSave()}},{key:"destroyGameTraining",value:function(){this.gameTraining.destroy(),this.gameTraining=null,app.user.setGameTraining(!0)}},{key:"reset",value:function(){this.tiles.forEach((function(t){return t.destroy()})),this.field=this.field.map((function(t){return t.map((function(){return"0"}))})),this.tileCurrent=null,this.nextTile=null,this.setTimeoutSuperTile(),app.user.resetScore(),app.user.setGameSave()}},{key:"setTimeoutSuperTile",value:function(){this.timeoutSuperTile=G.getRandomInteger(10,20)}},{key:"getStateControlButton",value:function(t){return app.keyboard.getState(t)||app.stateButtons.getState("game_control",t)}},{key:"tileGenerate",value:function(){if(null===this.tileCurrent){var t=kt.GET_BY_ID(this.nextTile)||kt.SIMPLE[G.getRandomInteger(0,kt.SIMPLE.length-1)];this.nextTile=0===this.timeoutSuperTile?kt.SUPER[G.getRandomInteger(0,kt.SUPER.length-1)].ID:kt.SIMPLE[G.getRandomInteger(0,kt.SIMPLE.length-1)].ID;var e=new ht(this.ctx,{x:Math.floor(this.field[0].length/2)*this.tileSize,y:-(90+this.tileSize),size:this.tileSize,id:t.ID,name:t.NAME});this.tiles.push(e),this.tileCurrent=e,this.timeoutSuperTile>=1?this.timeoutSuperTile-=1:this.setTimeoutSuperTile(),this.tiles.length>1&&this.gameSave()}}},{key:"searchTile",value:function(t,e){return this.tiles.find((function(r){return r.row===t&&r.col===e}))}},{key:"getPositionTile",value:function(t){return{row:Math.max(Math.ceil(t.y/this.tileSize),-1),col:Math.ceil(t.endX/this.tileSize)}}},{key:"moveTilesDown",value:function(){for(var t=this,e=[],r=this.field.length-1;r>=0;r--)for(var n=this.field[0].length-1;n>=0;n--)if("0"!==this.field[r][n]){for(var i=r;i<this.field.length-1&&"0"===this.field[i+1][n];)i++;if(r!==i){var o=this.searchTile(r,n);this.field[r][n]="0",this.field[i][n]="X",o.unsetCell(),o.speedY=7,o.setPositionY(i*this.tileSize),e.push({row:i,col:n})}}e.forEach((function(e){t.field[e.row][e.col]="0"}))}},{key:"getFigureOnField",value:function(t,e,r){for(var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=null,o=[],s=0;s<r.length;s++)for(var a=0;a<r[0].length;a++)if("0"!==r[s][a]){var u=this.field[t+s][e+a];if("0"===u)return[];if(u!==n||null===n){if(null!==i&&i!==u)return[];i=u}o.push({row:t+s,col:e+a})}return o}},{key:"clearFiguresOnField",value:function(){var t,e=this,r=kt.GET_BY_NAME("mixed").ID,n=function(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return zt(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?zt(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return s=t.done,t},e:function(t){a=!0,o=t},f:function(){try{s||null==r.return||r.return()}finally{if(a)throw o}}}}(dt);try{for(n.s();!(t=n.n()).done;)for(var i=t.value,o=0;o<this.field.length-i.pattern.length+1;o++)for(var s=0;s<this.field[0].length-i.pattern[0].length+1;s++){var a=this.getFigureOnField(o,s,i.pattern,r);if(a.forEach((function(t){e.field[t.row][t.col]="0",e.searchTile(t.row,t.col).destroy()})),a.length){app.user.upScore(i.price);var u=(s+2)*this.tileSize-this.tileSize/2,c=(o+2)*this.tileSize-this.tileSize/2;this.scoreParticles.push(new Ot(this.ctx,u,c,"+".concat(i.price)))}}}catch(t){n.e(t)}finally{n.f()}}},{key:"clearBombOnField",value:function(){for(var t=kt.GET_BY_NAME("bomb").ID,e=[[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]],r=this.field.length-1;r>=0;r--)for(var n=this.field[0].length-1;n>=0;n--)if("0"!==this.field[r][n]&&this.field[r][n]===t){this.field[r][n]="0",this.searchTile(r,n).destroy();for(var i=0;i<e.length;i++){var o,s=r+e[i][0],a=n+e[i][1];null!==(o=this.field)&&void 0!==o&&null!==(o=o[s])&&void 0!==o&&o[a]&&"0"!==this.field[s][a]&&(this.field[s][a]="0",this.searchTile(s,a).destroy())}}}},{key:"getTileBorderY",value:function(t,e){var r=this;return this.field.reduce((function(t,n){return"0"===n[e]?t+r.tileSize:t}),0)-this.tileSize}},{key:"draw",value:function(){var t;this.ctx.save(),this.ctx.translate(this.x,this.y),this.ctx.drawImage(this.skinField,0,0),this.tiles.forEach((function(t){t.destroyed||t.draw()})),this.scoreParticles.forEach((function(t){return t.draw()})),this.ctx.restore(),null!==this.gameTraining&&(null===(t=this.gameTraining)||void 0===t||t.draw())}},{key:"update",value:function(t){var e=this;if(null===this.gameTraining)if(null!==this.tileCurrent&&this.tileCurrent.y<0&&!this.tileCurrent.moved)this.gameOver();else{if(this.tiles=this.tiles.filter((function(t){if(t.destroyed)return!1;if(!t.moved&&!t.removed){var r=e.getPositionTile(t),n=r.row,i=r.col;t.setCell(n,i),e.field[n][i]=t.id,t===e.tileCurrent&&(e.tileCurrent=null)}return!0})),this.tiles.find((function(t){return t.moved}))||(this.clearBombOnField(),this.clearFiguresOnField()),this.tiles.find((function(t){return t.moved||t.removed}))||this.moveTilesDown(),!this.tiles.find((function(t){return t.moved||t.destroyed||t.removed}))&&this.tiles.length<=this.field.length*this.field[0].length&&this.tileGenerate(),null!==this.tileCurrent){var r=this.getPositionTile(this.tileCurrent),n=r.row,i=r.col,o=-1===n||"0"===this.field[n][i-1],s=-1===n||"0"===this.field[n][i+1],a=this.getStateControlButton("left")&&0!==i&&o,u=this.getStateControlButton("right")&&i<this.field[0].length-1&&s;this.tileCurrent.setMoveX((u-a)*this.tileSize),this.tileCurrent.setPositionY(this.getTileBorderY(n,i));var c=this.getStateControlButton("down");c?this.prevBoost.tile!==this.tileCurrent&&0!==this.prevBoost.state||(this.tileCurrent.setBoostY(),this.prevBoost.state=c,this.prevBoost.tile=this.tileCurrent):(this.prevBoost.state=c,this.prevBoost.tile=this.tileCurrent)}this.tiles.forEach((function(e){return e.update(t)})),this.scoreParticles=this.scoreParticles.filter((function(e){return!e.destroyed&&(e.update(t),!0)}))}else this.gameTraining.update(t)}}],r&&It(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Nt(t){return Nt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Nt(t)}function Ft(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,i=function(t,e){if("object"!==Nt(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Nt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===Nt(i)?i:String(i)),n)}var i}var Ht=function(){function t(e,r){var n;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.ctx=e,this.x=r.x||0,this.y=r.y||0,this.w=r.w,this.h=r.h,this.hover=0,this.handler=r.handler||function(){},this.clickHandler=this.click.bind(this),this.mousemoveHandler=this.mousemove.bind(this),this.isActive=null===(n=r.isActive)||void 0===n||n,this.init()}var e,r;return e=t,(r=[{key:"init",value:function(){this.isActive&&this.addListeners()}},{key:"destroy",value:function(){this.removeListeners()}},{key:"setActive",value:function(t){this.isActive=t,this.isActive?this.addListeners():this.removeListeners()}},{key:"addListeners",value:function(){app.cnv.addEventListener("click",this.clickHandler),window.addEventListener("mousemove",this.mousemoveHandler)}},{key:"removeListeners",value:function(){app.cnv.removeEventListener("click",this.clickHandler),window.removeEventListener("mousemove",this.mousemoveHandler),this.hover=0}},{key:"click",value:function(t){var e=app.cnv.getBoundingClientRect(),r=(t.clientX-e.left)/app.scale,n=(t.clientY-e.top)/app.scale;r>this.x&&r<this.x+this.w&&n>this.y&&n<this.y+this.h&&this.handler()}},{key:"mousemove",value:function(t){var e=app.cnv.getBoundingClientRect(),r=(t.clientX-e.left)/app.scale,n=(t.clientY-e.top)/app.scale;this.hover=r>this.x&&r<this.x+this.w&&n>this.y&&n<this.y+this.h}},{key:"draw",value:function(){this.ctx.save(),this.ctx.translate(this.x,this.y),this.hover&&this.ctx.fillRect(0,0,this.w,this.h),this.ctx.restore()}}])&&Ft(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Gt(t){return Gt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Gt(t)}function Xt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,i=function(t,e){if("object"!==Gt(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Gt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===Gt(i)?i:String(i)),n)}var i}function Wt(t,e){return Wt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Wt(t,e)}function Ut(t){return Ut=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Ut(t)}var Kt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Wt(t,e)}(s,t);var e,r,n,i,o=(n=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Ut(n);if(i){var r=Ut(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Gt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function s(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),(r=o.call(this,t,e)).scene=e.scene,r.playPath2D=G.getPath2DRoundedPolygon([{x:0,y:0},{x:40,y:25},{x:0,y:50}],4),r.pausePath2D=G.getPath2DRoundRect(0,0,14,44,4),r}return e=s,(r=[{key:"draw",value:function(){this.ctx.save(),this.hover&&(this.ctx.globalAlpha=.8),this.ctx.fillStyle="rgb(115,97,97)",this.scene.paused?(this.ctx.translate(this.x+21,this.y+20),this.ctx.fill(this.playPath2D)):(this.ctx.translate(this.x+19,this.y+23),this.ctx.fill(this.pausePath2D),this.ctx.translate(24,0),this.ctx.fill(this.pausePath2D)),this.ctx.restore()}}])&&Xt(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),s}(Ht);function qt(t){return qt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},qt(t)}function Vt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,i=function(t,e){if("object"!==qt(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==qt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===qt(i)?i:String(i)),n)}var i}function Jt(t,e){return Jt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Jt(t,e)}function Zt(t){return Zt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Zt(t)}var $t=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Jt(t,e)}(s,t);var e,r,n,i,o=(n=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Zt(n);if(i){var r=Zt(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===qt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function s(t,e){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),o.call(this,t,e)}return e=s,(r=[{key:"draw",value:function(){this.ctx.save(),this.ctx.translate(this.x+this.w/2,this.y+this.h/2),this.hover&&(this.ctx.globalAlpha=.8),this.ctx.lineWidth=4,this.ctx.font="bold 32px Balsamiq Sans",this.ctx.fillStyle="rgb(115,97,97)",this.ctx.strokeStyle="rgb(115,97,97)",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText("?",0,4),this.ctx.beginPath(),this.ctx.arc(0,0,23,0,2*Math.PI),this.ctx.stroke(),this.ctx.restore()}}])&&Vt(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),s}(Ht);function Qt(t){return Qt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Qt(t)}function te(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,i=function(t,e){if("object"!==Qt(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Qt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===Qt(i)?i:String(i)),n)}var i}function ee(t,e){return ee=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},ee(t,e)}function re(t){return re=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},re(t)}var ne=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ee(t,e)}(s,t);var e,r,n,i,o=(n=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=re(n);if(i){var r=re(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Qt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function s(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),(r=o.call(this,t,e)).arrowPath2D=G.getPath2DRoundedPolygon([{x:-16,y:0},{x:16,y:0},{x:0,y:15}],3),r}return e=s,(r=[{key:"draw",value:function(){this.ctx.save(),this.ctx.translate(this.x+this.w/2+2,this.y+this.h/2),this.hover&&(this.ctx.globalAlpha=.8),this.ctx.lineWidth=4,this.ctx.lineCap="round",this.ctx.fillStyle="rgb(115,97,97)",this.ctx.strokeStyle="rgb(115,97,97)",this.ctx.beginPath(),this.ctx.arc(0,0,20,-Math.PI,Math.PI/2),this.ctx.stroke(),this.ctx.closePath(),this.ctx.translate(-this.w/2+20,0),this.ctx.fill(this.arrowPath2D),this.ctx.restore()}}])&&te(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),s}(Ht);function ie(t){return ie="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ie(t)}function oe(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,i=function(t,e){if("object"!==ie(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==ie(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===ie(i)?i:String(i)),n)}var i}function se(t,e){return se=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},se(t,e)}function ae(t){return ae=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},ae(t)}var ue=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&se(t,e)}(s,t);var e,r,n,i,o=(n=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=ae(n);if(i){var r=ae(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===ie(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function s(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),(r=o.call(this,t,e)).homePath2D=G.getPath2DRoundedPolygon([{x:0,y:-22},{x:20,y:-5},{x:20,y:22},{x:-20,y:22},{x:-20,y:-5}],4),r}return e=s,(r=[{key:"draw",value:function(){this.ctx.save(),this.ctx.translate(this.x+this.w/2,this.y+this.h/2),this.hover&&(this.ctx.globalAlpha=.8),this.ctx.lineWidth=4,this.ctx.strokeStyle="rgb(115,97,97)",this.ctx.stroke(this.homePath2D),this.ctx.restore()}}])&&oe(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),s}(Ht);function ce(t){return ce="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ce(t)}function le(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,i=function(t,e){if("object"!==ce(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==ce(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===ce(i)?i:String(i)),n)}var i}var he=function(){function t(e,r){var n,i=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.ctx=e,this.scene=r,this.x=-app.size.w/2,this.y=-app.size.h/2,this.isActive=null===(n=o.isActive)||void 0===n||n,this.buttons=[new Kt(e,{x:app.size.w-78-9,y:0,w:78,h:90,handler:function(){return i.scene.setPaused()},scene:r}),new $t(e,{x:app.size.w-156-9,y:0,w:78,h:90,handler:function(){return i.scene.openModal("Info",!1)}}),new ne(e,{x:app.size.w-234-9,y:0,w:78,h:90,handler:function(){return i.scene.openModal("Reload")}}),new ue(e,{x:app.size.w-312-9,y:0,w:78,h:90,handler:function(){return app.scene.start("Main")}})],this.buttonHover=!1}var e,r;return e=t,(r=[{key:"destroy",value:function(){this.buttons.forEach((function(t){return t.destroy()}))}},{key:"setActive",value:function(t){this.isActive=t,this.buttons.forEach((function(e){return e.setActive(t)}))}},{key:"draw",value:function(){this.ctx.save(),this.ctx.translate(this.x,this.y),this.ctx.shadowBlur=4,this.ctx.shadowColor="rgba(0,0,0,0.1)",this.ctx.shadowOffsetX=2,this.ctx.shadowOffsetY=2,this.ctx.font="bold 48px ".concat(U),this.ctx.fillStyle=X,this.ctx.textAlign="left",this.ctx.textBaseline="middle",this.ctx.fillText("".concat(A.SCORE,": ").concat(app.user.score),12,52),this.buttons.forEach((function(t){return t.draw()})),this.ctx.restore()}},{key:"update",value:function(t){this.buttonHover=this.buttons.some((function(t){return t.hover}))}}])&&le(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function fe(t){return fe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},fe(t)}function ye(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,i=function(t,e){if("object"!==fe(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==fe(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===fe(i)?i:String(i)),n)}var i}var pe=function(){function t(e,r){var n;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.ctx=e,this.x=r.x||0,this.y=r.y||0,this.w=r.w,this.h=r.h,this.hover=0,this.isActive=null===(n=r.isActive)||void 0===n||n,this.type=r.type||"game_control",this.name=r.name||"game_control",this.state=0,this.touchID=null,this.handlerTouchStart=this.touchStart.bind(this),this.handlerTouchEnd=this.touchEnd.bind(this),this.mousedownHandler=this.mousedown.bind(this),this.mouseupHandler=this.mouseup.bind(this),this.mousemoveHandler=this.mousemove.bind(this),this.init()}var e,r;return e=t,(r=[{key:"init",value:function(){this.isActive&&this.addListeners()}},{key:"destroy",value:function(){this.removeListeners()}},{key:"setState",value:function(t){this.state=t,G.isTouchDevice&&(this.hover=t),app.stateButtons.setState(this.type,this.name,t)}},{key:"setActive",value:function(t){this.isActive=t,this.isActive?this.addListeners():this.removeListeners(),this.setState(!1)}},{key:"addListeners",value:function(){app.cnv.addEventListener("touchstart",this.handlerTouchStart),app.cnv.addEventListener("touchend",this.handlerTouchEnd),app.cnv.addEventListener("mousedown",this.mousedownHandler),app.cnv.addEventListener("mouseup",this.mouseupHandler),window.addEventListener("mousemove",this.mousemoveHandler)}},{key:"removeListeners",value:function(){app.cnv.removeEventListener("touchstart",this.handlerTouchStart),app.cnv.removeEventListener("touchend",this.handlerTouchEnd),app.cnv.removeEventListener("mousedown",this.mousedownHandler),app.cnv.removeEventListener("mouseup",this.mouseupHandler),window.removeEventListener("mousemove",this.mousemoveHandler),this.hover=0}},{key:"touchStart",value:function(t){if(null===this.touchID){var e=app.cnv.getBoundingClientRect();for(var r in t.touches){var n=(t.touches[r].clientX-e.left)/app.scale,i=(t.touches[r].clientY-e.top)/app.scale-app.size.h/2;if(n>this.x&&n<this.x+this.w&&i>this.y&&i<this.y+this.h)return this.setState(1),void(this.touchID=t.touches[r].identifier)}}}},{key:"touchEnd",value:function(t){for(var e in t.changedTouches)if(t.changedTouches[e].identifier===this.touchID)return this.setState(0),void(this.touchID=null)}},{key:"mousedown",value:function(t){var e=app.cnv.getBoundingClientRect(),r=(t.clientX-e.left)/app.scale,n=(t.clientY-e.top)/app.scale-app.size.h/2;r>this.x&&r<this.x+this.w&&n>this.y&&n<this.y+this.h&&this.setState(1)}},{key:"mouseup",value:function(){this.setState(0)}},{key:"mousemove",value:function(t){var e=app.cnv.getBoundingClientRect(),r=(t.clientX-e.left)/app.scale,n=(t.clientY-e.top)/app.scale-app.size.h/2;this.hover=r>this.x&&r<this.x+this.w&&n>this.y&&n<this.y+this.h}},{key:"draw",value:function(){this.ctx.save(),this.ctx.translate(this.x,this.y),this.hover&&this.ctx.fillRect(0,0,this.w,this.h),this.ctx.restore()}}])&&ye(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function ve(t){return ve="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ve(t)}function de(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,i=function(t,e){if("object"!==ve(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==ve(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===ve(i)?i:String(i)),n)}var i}function me(t,e){return me=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},me(t,e)}function be(t){return be=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},be(t)}var ge=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&me(t,e)}(s,t);var e,r,n,i,o=(n=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=be(n);if(i){var r=be(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===ve(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function s(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),(r=o.call(this,t,e)).arrowPath2D=G.getPath2DRoundedPolygon([{x:-80,y:0},{x:80,y:0},{x:0,y:100}],6),r}return e=s,(r=[{key:"draw",value:function(){this.ctx.save(),this.ctx.translate(this.x+this.w/2,this.y+this.h/2-50),this.ctx.shadowBlur=4,this.ctx.shadowColor="rgba(0,0,0,0.2)",this.ctx.shadowOffsetX=2,this.ctx.shadowOffsetY=2,this.ctx.fillStyle=this.hover?"#f3e9e7":"#eee1dd",this.ctx.fill(this.arrowPath2D),this.ctx.restore()}}])&&de(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),s}(pe);function we(t){return we="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},we(t)}function xe(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,i=function(t,e){if("object"!==we(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==we(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===we(i)?i:String(i)),n)}var i}function Se(t,e){return Se=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Se(t,e)}function ke(t){return ke=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},ke(t)}var Pe=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Se(t,e)}(s,t);var e,r,n,i,o=(n=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=ke(n);if(i){var r=ke(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===we(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function s(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),(r=o.call(this,t,e)).arrowPath2D=G.getPath2DRoundedPolygon([{x:-20,y:-40},{x:-20,y:40},{x:40,y:0}],6),r}return e=s,(r=[{key:"draw",value:function(){this.ctx.save(),this.ctx.shadowBlur=4,this.ctx.shadowColor="rgba(0,0,0,0.2)",this.ctx.shadowOffsetX=2,this.ctx.shadowOffsetY=2,this.ctx.translate(this.x+this.w/2,this.y+this.h/2),this.ctx.fillStyle=this.hover?"#f3e9e7":"#eee1dd",this.ctx.fill(this.arrowPath2D),this.ctx.restore()}}])&&xe(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),s}(pe);function Te(t){return Te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Te(t)}function Oe(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,i=function(t,e){if("object"!==Te(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Te(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===Te(i)?i:String(i)),n)}var i}function Ee(t,e){return Ee=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Ee(t,e)}function je(t){return je=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},je(t)}var Le=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ee(t,e)}(s,t);var e,r,n,i,o=(n=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=je(n);if(i){var r=je(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Te(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function s(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),(r=o.call(this,t,e)).arrowPath2D=G.getPath2DRoundedPolygon([{x:20,y:-40},{x:20,y:40},{x:-40,y:0}],6),r}return e=s,(r=[{key:"draw",value:function(){this.ctx.save(),this.ctx.translate(this.x+this.w/2,this.y+this.h/2),this.ctx.shadowBlur=4,this.ctx.shadowColor="rgba(0,0,0,0.2)",this.ctx.shadowOffsetX=2,this.ctx.shadowOffsetY=2,this.ctx.fillStyle=this.hover?"#f3e9e7":"#eee1dd",this.ctx.fill(this.arrowPath2D),this.ctx.restore()}}])&&Oe(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),s}(pe);function Ce(t){return Ce="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ce(t)}function Ae(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,i=function(t,e){if("object"!==Ce(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Ce(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===Ce(i)?i:String(i)),n)}var i}var Be=function(){function t(e,r){var n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.ctx=e,this.scene=r,this.x=-app.size.w/2,this.y=0,this.h=170,this.isActive=null===(n=i.isActive)||void 0===n||n,this.typeButtons="game_control",this.buttons={left:new Le(e,{x:0,y:app.size.h/2-this.h,w:app.size.w/3,h:this.h,type:this.typeButtons,name:"left"}),down:new ge(e,{x:app.size.w/3,y:app.size.h/2-this.h,w:app.size.w/3,h:this.h,type:this.typeButtons,name:"down"}),right:new Pe(e,{x:app.size.w/3*2,y:app.size.h/2-this.h,w:app.size.w/3,h:this.h,type:this.typeButtons,name:"right"})},this.buttonHover=!1,this.init()}var e,r;return e=t,(r=[{key:"init",value:function(){for(var t in this.buttons)app.stateButtons.add(this.typeButtons,t)}},{key:"destroy",value:function(){for(var t in this.buttons)this.buttons[t].destroy(),app.stateButtons.remove(this.typeButtons,t);app.cnv.style.cursor=""}},{key:"setActive",value:function(t){for(var e in this.isActive=t,this.buttons)this.buttons[e].setActive(t)}},{key:"draw",value:function(){for(var t in this.ctx.save(),this.ctx.translate(this.x,this.y),this.buttons)this.buttons[t].draw();this.ctx.restore()}},{key:"update",value:function(t){for(var e in this.buttonHover=!1,this.buttons)this.buttons[e].hover&&(this.buttonHover=!0)}}])&&Ae(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Re(t){return Re="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Re(t)}function _e(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,i=function(t,e){if("object"!==Re(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Re(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===Re(i)?i:String(i)),n)}var i}var Me=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.ctx=e,this.current=null,this.layers={}}var e,r;return e=t,(r=[{key:"add",value:function(t,e){this.layers.hasOwnProperty(t)?console.log('Слой "'.concat(t,'" уже добавлен')):this.layers[t]=e}},{key:"start",value:function(t,e,r){this.layers.hasOwnProperty(t)?(null!==this.current&&"destroy"in this.current&&this.current.destroy(),this.current=new this.layers[t](this.ctx,e,r)):console.log('Слой "'.concat(t,'" не найден'))}},{key:"stop",value:function(){null!==this.current&&"destroy"in this.current&&this.current.destroy(),this.current=null}},{key:"remove",value:function(){}},{key:"draw",value:function(){null!==this.current&&"draw"in this.current&&this.current.draw()}},{key:"update",value:function(t){null!==this.current&&"update"in this.current&&this.current.update(t)}}])&&_e(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function De(t){return De="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},De(t)}function ze(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,i=function(t,e){if("object"!==De(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==De(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===De(i)?i:String(i)),n)}var i}var Ie=function(){function t(e,r){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.ctx=e,this.scene=r,this.x=0,this.y=0,this.w=650,this.h=400,this.buttonHover=!1,this.buttons=[new Z(e,{text:A.START_OVER,y:-150,handler:function(){return n.scene.reload()},dark:!0}),new Z(e,{text:A.CANCEL,y:0,handler:function(){return n.scene.closeModal()},dark:!0})]}var e,r;return e=t,(r=[{key:"destroy",value:function(){this.buttons.forEach((function(t){return t.destroy()}))}},{key:"draw",value:function(){this.ctx.save(),this.buttons.forEach((function(t){return t.draw()})),this.ctx.restore()}},{key:"update",value:function(t){this.buttonHover=this.buttons.some((function(t){return t.hover}))}}])&&ze(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Ye(t){return Ye="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ye(t)}function Ne(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,i=function(t,e){if("object"!==Ye(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Ye(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===Ye(i)?i:String(i)),n)}var i}var Fe=function(){function t(e,r){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.ctx=e,this.scene=r,this.x=0,this.y=0,this.w=620,this.h=550,this.titleSize=K,this.titleFont="".concat(this.titleSize,"px ").concat(U),this.path2D=G.getPath2DRoundRect(0,0,this.w,this.h,8),this.buttonHover=!1,this.buttons=[new Z(e,{text:A.START_OVER,y:-80,handler:function(){return n.scene.reload()},dark:!0}),new Z(e,{text:A.EXIT,y:70,handler:function(){return app.scene.start("Main")},dark:!0})]}var e,r;return e=t,(r=[{key:"destroy",value:function(){this.buttons.forEach((function(t){return t.destroy()}))}},{key:"draw",value:function(){this.ctx.save(),this.ctx.translate(-this.w/2,-this.h/2-80),this.ctx.shadowBlur=4,this.ctx.shadowColor="rgba(0,0,0,0.2)",this.ctx.shadowOffsetX=2,this.ctx.shadowOffsetY=2,this.ctx.fillStyle=W,this.ctx.strokeStyle=X,this.ctx.fill(this.path2D),this.ctx.stroke(this.path2D),this.ctx.restore(),this.ctx.font=this.titleFont;var t="".concat(A.GAME_OVER);this.ctx.shadowBlur=4,this.ctx.shadowColor="rgba(0,0,0,0.1)",this.ctx.shadowOffsetX=2,this.ctx.shadowOffsetY=2,this.ctx.fillStyle=X,this.ctx.textAlign="center",this.ctx.fillText(t,0,-220),this.ctx.save(),this.buttons.forEach((function(t){return t.draw()})),this.ctx.restore()}},{key:"update",value:function(t){this.buttonHover=this.buttons.some((function(t){return t.hover}))}}])&&Ne(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function He(t){return He="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},He(t)}function Ge(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,i=function(t,e){if("object"!==He(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==He(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===He(i)?i:String(i)),n)}var i}var Xe=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.object=e,this.handlerWheel=this.wheel.bind(this),this.handlerTouchstart=this.touchstart.bind(this),this.handlerTouchmove=this.touchmove.bind(this),this.handlerTouchend=this.touchend.bind(this),this.touchstartPoint={x:0,y:0},this.inert={x:0,y:0},this.tempInert={x:0,y:0},this.startTime=performance.now(),this.init()}var e,r;return e=t,(r=[{key:"init",value:function(){window.addEventListener("wheel",this.handlerWheel),window.addEventListener("touchstart",this.handlerTouchstart),window.addEventListener("touchmove",this.handlerTouchmove),window.addEventListener("touchend",this.handlerTouchend)}},{key:"destroy",value:function(){window.removeEventListener("wheel",this.handlerWheel),window.removeEventListener("touchstart",this.handlerTouchstart),window.removeEventListener("touchmove",this.handlerTouchmove),window.removeEventListener("touchend",this.handlerTouchend)}},{key:"wheel",value:function(t){this.object.y=Math.max(Math.min(this.object.y-t.deltaY,0),-this.object.h)}},{key:"touchstart",value:function(t){this.touchstartPoint.x=t.touches[0].pageX,this.touchstartPoint.y=t.touches[0].pageY,this.inert.x=0,this.inert.y=0,this.tempInert.x=0,this.tempInert.y=0,this.startTime=performance.now()}},{key:"touchmove",value:function(t){var e=t.touches[0].pageY-this.touchstartPoint.y,r=performance.now()-this.startTime,n=e/app.scale;this.tempInert.y=e/r*30,this.touchstartPoint.y=t.touches[0].pageY,this.object.y=Math.max(Math.min(this.object.y+n,0),-this.object.h),this.startTime=performance.now()}},{key:"touchend",value:function(t){this.inert.y=this.tempInert.y,this.touchstartPoint.x=0,this.touchstartPoint.y=0,this.tempInert.x=0,this.tempInert.y=0}},{key:"update",value:function(t){Math.abs(this.inert.y)>.1?(this.object.y=Math.max(Math.min(this.object.y+this.inert.y,0),-this.object.h),this.inert.y*=.95):this.inert.y=0}}])&&Ge(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function We(t){return We="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},We(t)}function Ue(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,i=function(t,e){if("object"!==We(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==We(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===We(i)?i:String(i)),n)}var i}var Ke=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.btnBackName,i=void 0===n?A.BACK:n,o=r.btnBackHandler,s=void 0===o?function(){return app.scene.start("Main")}:o;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.ctx=e,this.x=0,this.y=0,this.btnBack=new Z(e,{text:i,handler:s}),this.buttonHover=!1,this.figures=[],this.h=840,this.scrollSystem=new Xe(this),this.init()}var e,r;return e=t,(r=[{key:"init",value:function(){var t=this,e=["green","red","purple","blue"];dt.forEach((function(r){t.figures.find((function(t){return t.price===r.price}))||t.figures.push({price:r.price,image:Lt.getFigure({pattern:r.pattern,tileName:e[t.figures.length],tileSize:78})})})),this.figures.sort((function(t,e){return t.price-e.price}))}},{key:"destroy",value:function(){this.scrollSystem.destroy(),this.btnBack.destroy()}},{key:"drawTitle",value:function(){this.ctx.save(),this.ctx.translate(app.size.w/2,0),this.ctx.textAlign="center",this.ctx.textBaseline="top",this.ctx.fillStyle=X,this.ctx.font="".concat(K,"px ").concat(U),this.ctx.fillText(A.HOW_TO_PLAY,0,0),this.ctx.restore()}},{key:"drawDescriptionFigures",value:function(){var t=this;this.ctx.save(),this.ctx.translate(app.size.w/2,0),this.ctx.textAlign="center",this.ctx.textBaseline="top",this.ctx.fillStyle=X,this.ctx.font="".concat(q,"px ").concat(U);var e=0;A.HOW_TO_PLAY_DESCRIPTION_FIGURES.split("\n").forEach((function(r){t.ctx.fillText(r,0,q*e),e++})),this.ctx.restore()}},{key:"drawDescriptionSuperTiles",value:function(){this.ctx.save(),this.ctx.translate(app.size.w/2,0),this.ctx.textAlign="center",this.ctx.textBaseline="top",this.ctx.fillStyle=X,this.ctx.font="".concat(q,"px ").concat(U),this.ctx.fillText(A.HOW_TO_PLAY_DESCRIPTION_SUPER_TILES,0,0),this.ctx.restore()}},{key:"drawFigures",value:function(){var t=this;this.ctx.save(),this.ctx.translate(32,0),this.ctx.textAlign="left",this.ctx.textBaseline="top",this.figures.forEach((function(e,r){var n=G.getPath2DRoundRect(0,0,e.image.width+80,e.image.height+180,20);t.ctx.fillStyle=W,t.ctx.fill(n),t.ctx.drawImage(e.image,40,140),t.ctx.fillStyle=X,t.ctx.font="42px ".concat(U),t.ctx.fillText("".concat(e.price," ").concat(A.POINTS),40,40),t.ctx.beginPath(),t.ctx.strokeStyle=X,t.ctx.lineWidth=2,t.ctx.moveTo(40,100),t.ctx.lineTo(e.image.width+40,100),t.ctx.stroke(),t.ctx.closePath(),r%2?t.ctx.translate(-(e.image.width+100),e.image.height+200):t.ctx.translate(e.image.width+100,0)})),this.ctx.restore()}},{key:"drawSuperTiles",value:function(){this.ctx.save(),this.ctx.translate(32,0),this.ctx.textAlign="left",this.ctx.textBaseline="top",this.ctx.fillStyle=W;var t=G.getPath2DRoundRect(0,0,660,160,20);this.ctx.fill(t),this.ctx.translate(40,40),this.ctx.drawImage(app.resources.tiles.mixed,-2,-2),this.ctx.translate(110,0),this.ctx.fillStyle=X,this.ctx.font="42px ".concat(U),this.ctx.fillText("".concat(A.MIXED),0,0),this.ctx.font="32px ".concat(U),this.ctx.fillText("".concat(A.TILE_MIXED_DESC),0,50),this.ctx.fillStyle=W,this.ctx.translate(-150,140),this.ctx.fill(t),this.ctx.translate(40,40),this.ctx.drawImage(app.resources.tiles.bomb,-2,-2),this.ctx.translate(110,0),this.ctx.fillStyle=X,this.ctx.font="42px ".concat(U),this.ctx.fillText("".concat(A.DESTROYER),0,0),this.ctx.font="32px ".concat(U),this.ctx.fillText("".concat(A.TILE_DESTROYER_DESC),0,50),this.ctx.restore()}},{key:"draw",value:function(){this.ctx.save(),this.ctx.shadowBlur=4,this.ctx.shadowColor="rgba(0,0,0,0.2)",this.ctx.shadowOffsetX=2,this.ctx.shadowOffsetY=2,this.ctx.translate(this.x-app.size.w/2,this.y-app.size.h/2+80),this.drawTitle(),this.ctx.translate(0,130),this.drawDescriptionFigures(),this.ctx.translate(0,200),this.drawFigures(),this.ctx.translate(0,940),this.drawDescriptionSuperTiles(),this.ctx.translate(0,120),this.drawSuperTiles(),this.ctx.restore(),this.ctx.save(),this.btnBack.draw(),this.btnBack.updatePosition(0,app.size.h/2-this.btnBack.h/2-80),this.ctx.restore()}},{key:"update",value:function(t){this.buttonHover=this.btnBack.hover,this.scrollSystem.update(t)}}])&&Ue(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function qe(t){return qe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},qe(t)}function Ve(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,i=function(t,e){if("object"!==qe(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==qe(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===qe(i)?i:String(i)),n)}var i}var Je=function(){function t(e,r){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.ctx=e,this.scene=r,this.w=app.size.w,this.h=app.size.h,this.buttonHover=!1,this.howToPlayLayer=new Ke(e,{btnBackName:A.CLOSE,btnBackHandler:function(){return n.scene.closeModal()}})}var e,r;return e=t,(r=[{key:"destroy",value:function(){this.howToPlayLayer.destroy()}},{key:"draw",value:function(){this.howToPlayLayer.draw()}},{key:"update",value:function(t){this.howToPlayLayer.update(t),this.buttonHover=this.howToPlayLayer.buttonHover}}])&&Ve(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Ze(t){return Ze="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ze(t)}function $e(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,i=function(t,e){if("object"!==Ze(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Ze(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===Ze(i)?i:String(i)),n)}var i}var Qe=function(){function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.ctx=e,this.paused=!1,this.headerLayer=new he(e,this),this.footerLayer=new Be(e,this),this.gameLayer=new Yt(e,this,r),this.layer=new Me(e),this.isShowBaseLayers=!0,this.init()}var e,r;return e=t,r=[{key:"init",value:function(){app.keyboard.addListener("paused","keydown","space",this.setPaused.bind(this)),this.layer.add("Reload",Ie),this.layer.add("GameOver",Fe),this.layer.add("Info",Je)}},{key:"destroy",value:function(){app.keyboard.removeListener("paused"),app.cnv.style.cursor="",this.headerLayer.destroy(),this.footerLayer.destroy(),this.layer.stop()}},{key:"openModal",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.isShowBaseLayers;this.setPaused(!0),this.layer.start(t,this),this.headerLayer.setActive(!1),this.footerLayer.setActive(!1),this.isShowBaseLayers=e}},{key:"closeModal",value:function(){this.setPaused(!1),this.layer.stop(),this.headerLayer.setActive(!0),this.footerLayer.setActive(!0),this.isShowBaseLayers=!0}},{key:"reload",value:function(){this.closeModal(),this.gameLayer.reset()}},{key:"setPaused",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!this.paused;this.paused=t}},{key:"draw",value:function(){this.ctx.save(),this.ctx.translate(0,0),this.isShowBaseLayers&&(this.headerLayer.draw(),this.footerLayer.draw(),this.gameLayer.draw()),this.layer.draw(),this.ctx.restore()}},{key:"update",value:function(t){this.headerLayer.update(t),this.footerLayer.update(t),this.paused||this.gameLayer.update(t),this.layer.update(t);var e=null!==this.layer.current&&this.layer.current.buttonHover;app.cnv.style.cursor=this.headerLayer.buttonHover||this.footerLayer.buttonHover||e?"pointer":"initial"}}],r&&$e(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function tr(t){return tr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tr(t)}function er(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,i=function(t,e){if("object"!==tr(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==tr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===tr(i)?i:String(i)),n)}var i}var rr=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.ctx=e,this.howToPlayLayer=new Ke(e,{btnBackName:A.BACK,btnBackHandler:function(){return app.scene.start("Main")}})}var e,r;return e=t,(r=[{key:"destroy",value:function(){this.howToPlayLayer.destroy(),app.cnv.style.cursor=""}},{key:"draw",value:function(){this.howToPlayLayer.draw()}},{key:"update",value:function(t){this.howToPlayLayer.update(t),this.buttonHover=this.howToPlayLayer.buttonHover,app.cnv.style.cursor=this.howToPlayLayer.buttonHover?"pointer":"initial"}}])&&er(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function nr(t){return nr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},nr(t)}function ir(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,i=function(t,e){if("object"!==nr(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==nr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===nr(i)?i:String(i)),n)}var i}var or=function(){function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.ctx=e,this.x=0,this.y=0,this.title=A.CONTROL,this.titleSize=85,this.titlePadding=60,this.titleFont="".concat(this.titleSize,"px ").concat(U),this.titleColor=X,this.subTitleSize=50,this.subTitlePadding=10,this.subTitleFont="".concat(this.subTitleSize,"px Balsamiq Sans"),this.subTitleColor=X,this.textSize=q,this.textLinePadding=20,this.textFont="".concat(this.textSize,"px Balsamiq Sans"),this.textColor=X,this.textBlockPadding=60,this.textBlockX=0,this.textBlockY=0,this.textBlocks=[{title:A.CONTROL_FROM_PC.TITLE,items:A.CONTROL_FROM_PC.ITEMS},{title:A.CONTROL_FROM_MOBILE.TITLE,items:A.CONTROL_FROM_MOBILE.ITEMS}],this.btnBack=new Z(e,{text:A.BACK,handler:function(){return app.scene.start("Main")}}),this.init()}var e,r;return e=t,(r=[{key:"init",value:function(){var t=this,e=this.title,r=this.textBlocks,n=this.titleSize,i=this.subTitleSize,o=this.textSize,s=this.titleFont,a=this.subTitleFont,u=this.textFont,c=this.titlePadding,l=this.subTitlePadding,h=this.textLinePadding,f=this.textBlockPadding,y=this.btnBack.h+n+c;this.ctx.font=s,this.textBlockX=Math.min(-this.ctx.measureText(e).width/2,this.textBlockX),r.forEach((function(e,r){t.ctx.font=a,t.textBlockX=Math.min(-t.ctx.measureText(e.title).width/2,t.textBlockX),y+=i+l+f,e.items.forEach((function(e){e.split("\n").forEach((function(e){t.ctx.font=u,t.textBlockX=Math.min(-t.ctx.measureText(e).width/2,t.textBlockX),y+=o+h}))}))})),this.textBlockY=-y/2+n/2,this.btnBack.updatePosition(0,y/2-this.btnBack.h/2+n/2)}},{key:"destroy",value:function(){this.btnBack.destroy(),app.cnv.style.cursor=""}},{key:"draw",value:function(){var t=this;this.ctx.save(),this.ctx.translate(this.x,this.y),this.ctx.shadowBlur=4,this.ctx.shadowColor="rgba(0,0,0,0.2)",this.ctx.shadowOffsetX=2,this.ctx.shadowOffsetY=2,this.ctx.font=this.titleFont,this.ctx.fillStyle=this.titleColor,this.ctx.fillText(this.title,-this.ctx.measureText(this.title).width/2,this.textBlockY);var e=0,r=0,n=0,i=function(){return t.textBlockY+t.titleSize+t.titlePadding+t.subTitleSize*e+t.subTitlePadding*e+t.textSize*r+t.textLinePadding*r+t.textBlockPadding*n};this.textBlocks.forEach((function(o){t.ctx.font=t.subTitleFont,t.ctx.fillStyle=t.subTitleColor,t.ctx.fillText(o.title,t.textBlockX,i()),e++,o.items.forEach((function(e){var n=e.split("\n");t.ctx.font=t.textFont,t.ctx.fillStyle=t.textColor,n.forEach((function(e){t.ctx.fillText(e,t.textBlockX,i()),r++}))})),n++})),this.btnBack.draw(),this.ctx.restore()}},{key:"update",value:function(t){app.cnv.style.cursor=this.btnBack.hover?"pointer":"initial"}}])&&ir(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function sr(t){return sr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},sr(t)}function ar(){ar=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(t,e,r){t[e]=r.value},o="function"==typeof Symbol?Symbol:{},s=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function c(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var o=e&&e.prototype instanceof m?e:m,s=Object.create(o.prototype),a=new C(n||[]);return i(s,"_invoke",{value:O(t,r,a)}),s}function h(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var f="suspendedStart",y="suspendedYield",p="executing",v="completed",d={};function m(){}function b(){}function g(){}var w={};c(w,s,(function(){return this}));var x=Object.getPrototypeOf,S=x&&x(x(A([])));S&&S!==r&&n.call(S,s)&&(w=S);var k=g.prototype=m.prototype=Object.create(w);function P(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function T(t,e){function r(i,o,s,a){var u=h(t[i],t,o);if("throw"!==u.type){var c=u.arg,l=c.value;return l&&"object"==sr(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,s,a)}),(function(t){r("throw",t,s,a)})):e.resolve(l).then((function(t){c.value=t,s(c)}),(function(t){return r("throw",t,s,a)}))}a(u.arg)}var o;i(this,"_invoke",{value:function(t,n){function i(){return new e((function(e,i){r(t,n,e,i)}))}return o=o?o.then(i,i):i()}})}function O(e,r,n){var i=f;return function(o,s){if(i===p)throw new Error("Generator is already running");if(i===v){if("throw"===o)throw s;return{value:t,done:!0}}for(n.method=o,n.arg=s;;){var a=n.delegate;if(a){var u=E(a,n);if(u){if(u===d)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===f)throw i=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=p;var c=h(e,r,n);if("normal"===c.type){if(i=n.done?v:y,c.arg===d)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(i=v,n.method="throw",n.arg=c.arg)}}}function E(e,r){var n=r.method,i=e.iterator[n];if(i===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,E(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),d;var o=h(i,e.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,d;var s=o.arg;return s?s.done?(r[e.resultName]=s.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,d):s:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,d)}function j(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function L(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function C(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(j,this),this.reset(!0)}function A(e){if(e||""===e){var r=e[s];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function r(){for(;++i<e.length;)if(n.call(e,i))return r.value=e[i],r.done=!1,r;return r.value=t,r.done=!0,r};return o.next=o}}throw new TypeError(sr(e)+" is not iterable")}return b.prototype=g,i(k,"constructor",{value:g,configurable:!0}),i(g,"constructor",{value:b,configurable:!0}),b.displayName=c(g,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===b||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,g):(t.__proto__=g,c(t,u,"GeneratorFunction")),t.prototype=Object.create(k),t},e.awrap=function(t){return{__await:t}},P(T.prototype),c(T.prototype,a,(function(){return this})),e.AsyncIterator=T,e.async=function(t,r,n,i,o){void 0===o&&(o=Promise);var s=new T(l(t,r,n,i),o);return e.isGeneratorFunction(r)?s:s.next().then((function(t){return t.done?t.value:s.next()}))},P(k),c(k,u,"Generator"),c(k,s,(function(){return this})),c(k,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=A,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(L),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function i(n,i){return a.type="throw",a.arg=e,r.next=n,i&&(r.method="next",r.arg=t),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var s=this.tryEntries[o],a=s.completion;if("root"===s.tryLoc)return i("end");if(s.tryLoc<=this.prev){var u=n.call(s,"catchLoc"),c=n.call(s,"finallyLoc");if(u&&c){if(this.prev<s.catchLoc)return i(s.catchLoc,!0);if(this.prev<s.finallyLoc)return i(s.finallyLoc)}else if(u){if(this.prev<s.catchLoc)return i(s.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return i(s.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=t,s.arg=e,o?(this.method="next",this.next=o.finallyLoc,d):this.complete(s)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),d},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),L(r),d}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;L(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:A(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),d}},e}function ur(t,e,r,n,i,o,s){try{var a=t[o](s),u=a.value}catch(t){return void r(t)}a.done?e(u):Promise.resolve(u).then(n,i)}function cr(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var o=t.apply(e,r);function s(t){ur(o,n,i,s,a,"next",t)}function a(t){ur(o,n,i,s,a,"throw",t)}s(void 0)}))}}function lr(){return hr.apply(this,arguments)}function hr(){return(hr=cr(ar().mark((function t(){var e;return ar().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,e=new FontFace("Balsamiq Sans","url(./assets/fonts/BalsamiqSans-Regular.ttf)"),t.next=4,e.load();case 4:document.fonts.add(e),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),console.error(t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))).apply(this,arguments)}function fr(){return yr.apply(this,arguments)}function yr(){return(yr=cr(ar().mark((function t(){var e,r,n;return ar().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,e=window.getComputedStyle(document.body),r=e.getPropertyValue("background-image"),n=r.match(/url\("?(.+?)"?\)/)[1],t.next=6,pr(n);case 6:t.next=11;break;case 8:t.prev=8,t.t0=t.catch(0),console.error(t.t0);case 11:case"end":return t.stop()}}),t,null,[[0,8]])})))).apply(this,arguments)}function pr(t){return new Promise((function(e,r){var n=new Image;n.src=t,n.onload=function(){return e(n)},n.onerror=function(e){return r(new Error("Failed to load image at ".concat(t,": ").concat(e)))}}))}window.app=new N(document.getElementById("cnv")),app.scene.add("Main",ot),app.scene.add("About",rr),app.scene.add("Control",or),app.scene.add("Game",Qe),app.scene.addLayer("Load",ut),document.title=A.TITLE,cr(ar().mark((function t(){return ar().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fr();case 2:return t.next=4,lr();case 4:kt.SIMPLE.forEach((function(t){app.resources.tiles[t.NAME]=Lt.getTile({id:t.ID,size:82,color:t.COLOR})})),kt.SUPER.forEach((function(t){app.resources.tiles[t.NAME]=Lt.getTileSuper(t.NAME,{size:82})})),app.scene.start("Main",{isActive:!1}),app.scene.getLayer("Load").loaded((function(){return app.scene.current.setActive(!0)}));case 6:case"end":return t.stop()}}),t)})))()}()}();